/*! backbone.collectionview - v0.1.0 - 2012-09-13
* https://github.com/anthonyshort/backbone.collectionview
* Copyright (c) 2012 Anthony Short; Licensed MIT */
(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},r=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Backbone.CollectionView=function(i){function s(t){t==null&&(t={}),this.onReset=e(this.onReset,this),this.onRemove=e(this.onRemove,this),this.onAdd=e(this.onAdd,this),this.onReady=e(this.onReady,this),this.onLoad=e(this.onLoad,this),s.__super__.constructor.apply(this,arguments);if(!t.collection)throw"Backbone.CollectionView requires a collection";_(t).defaults({render:!1,renderItems:!1}),this.viewsByCid={},this.collectionEvents||(this.collectionEvents={}),this.addCollectionListeners(t.collection),this.viewEvents||(this.viewEvents={}),this.itemView=t.itemView||this.itemView,t.render&&this.render(),t.renderItems&&this.renderAllItems()}return n(s,i),s.extend=Backbone.Model.extend,s.include=function(e){var t,n,i;for(t in e)n=e[t],r.call(moduleKeywords,t)<0&&(this.prototype[t]||(this.prototype[t]=n));return(i=e.included)!=null&&i.apply(this),this},s.prototype.itemView=null,s.prototype.emptyClass="is-empty",s.prototype.loadingClass="is-loading",s.prototype.itemSelector=null,s.prototype.listSelector=null,s.prototype.list=null,s.prototype.viewsByCid=null,s.prototype.addCollectionListeners=function(e){var t,n,r;e.on("add",this.onAdd,this),e.on("remove",this.onRemove,this),e.on("reset",this.onReset,this),e.on("loading",this.onLoad,this),e.on("ready",this.onReady,this),r=this.collectionEvents;for(n in r)t=r[n],e.on(n,this[t],this);return e},s.prototype.addViewListeners=function(e){var t,n,r;r=this.viewEvents;for(n in r)t=r[n],e.on(n,this[t],this);return e},s.prototype.onLoad=function(){return this.$el.addClass(this.loadingClass)},s.prototype.onReady=function(){return this.$el.removeClass(this.loadingClass),this.initFallback()},s.prototype.onAdd=function(e){return this.addModelView(e)},s.prototype.onRemove=function(e){return this.removeModelView(e)},s.prototype.onReset=function(){return this.renderAllItems()},s.prototype.add=function(e,t){var n;return e==null&&(e={}),t==null&&(t={}),n=new this.collection.model(e),this.collection.add(n,t),this.getViewByModel(n)},s.prototype.render=function(){return s.__super__.render.apply(this,arguments),this.list=this.listSelector?this.$(this.listSelector):this.$el,this.initFallback()},s.prototype.initFallback=function(){return this.collection.length===0?this.$el.addClass(this.emptyClass):this.$el.removeClass(this.emptyClass)},s.prototype.renderAllItems=function(){var e=this;return this.render(),this.clear(),this.collection.each(function(t){return e.addModelView(t)})},s.prototype.clear=function(){var e,n,r,i,s;this.list.empty(),i=this.viewsByCid,s=[];for(e in i){if(!t.call(i,e))continue;r=i[e],n=this.collection.get(e),n?s.push(this.removeModelView(n)):s.push(void 0)}return s},s.prototype.getItemView=function(e){if(!this.itemView)throw"Backbone.CollectionView needs an itemView property set. Alternatively override the getItemView method";return new this.itemView({model:e,collection:this.collection})},s.prototype.addModelView=function(e){var t;return t=this.getItemView(e),this.addViewListeners(t),t.render(),this.viewsByCid[e.cid]=t,this.initFallback(),this.renderItem(t,e),t},s.prototype.getViewByModel=function(e){return this.viewsByCid[e.cid]},s.prototype.removeModelView=function(e){var t;t=this.viewsByCid[e.cid];if(!t)return;return t.remove(),delete this.viewsByCid[e.cid],this.initFallback()},s.prototype.renderItem=function(e,t){var n,r;return n=this.list.children(this.itemSelector),r=this.collection.indexOf(t),r===0?this.list.prepend(e.$el):r<n.length?n.eq(r).before(e.$el):this.list.append(e.$el),this.afterRenderItem(e,t)},s.prototype.afterRenderItem=function(e,t){},s.prototype.dispose=function(){var e,t,n,r,i;s.__super__.dispose.apply(this,arguments),r=["list","viewsByCid","collection"],i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(delete this[e]);return i},s}(Backbone.View)}).call(this);